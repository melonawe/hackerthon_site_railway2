<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ê²Œì‹œê¸€ ì‘ì„±</title>

  <link rel="stylesheet" href="style.css" />

  <style>
    .wrap {
      display: flex;
      justify-content: center;
      padding-right: 0 !important;
    }
    .sidebar {
      display: none !important;
    }

    .menu-bar {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .menu-item {
      padding: 6px 14px;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 600;
      user-select: none;
      background: #f1f5ff;
      color: #2d6cdf;
      border: 1px solid #2d6cdf;
      transition: all 0.2s;
    }
    .menu-item.active {
      background: #2d6cdf;
      color: #fff;
    }
    .menu-item:hover {
      background: #3b7fe0;
      color: #fff;
    }

    .lang-toggle {
      padding: 6px 14px;
      border-radius: 999px;
      border: 1px solid #2d6cdf;
      background: #f1f5ff;
      color: #2d6cdf;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.16s;
    }
    .lang-toggle:hover { background: #3b7fe0; color: #fff; }

    .post-form-container {
      width: 100%;
      max-width: 800px;
      margin: 40px auto;
      background: #ffffff;
      padding: 26px;
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(11,22,40,0.06);
      border: 1px solid #dfe3eb;
    }

    .post-form-container h2 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 16px;
    }
    .form-group label {
      font-weight: 600;
      font-size: 0.9rem;
    }

    .form-group input,
    .form-group textarea {
      padding: 12px;
      border-radius: 8px;
      border: 1px solid #cbd5e1;
      font-size: 0.95rem;
    }
    .form-group textarea {
      height: 150px;
      resize: none;
    }

    .submit-btn {
      width: 100%;
      padding: 14px;
      background: #2d6cdf;
      color: #ffffff;
      font-weight: 700;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      margin-top: 10px;
    }
    .submit-btn:hover { background: #1f4fad; }
  </style>
</head>

<body>
  <header>
    <div class="title" id="siteTitle">ê²Œì‹œê¸€ ì‘ì„±</div>

    <div class="header-right" style="margin-left: auto; display: flex; gap: 12px; align-items: center">
      <nav class="menu-bar" id="menuBar">
        <div class="menu-item" id="menuMain" onclick="location.href='sample.html'">ë©”ì¸</div>
        <div class="menu-item" id="menuVocab" onclick="location.href='vocab.html'">ë‹¨ì–´ì¥</div>

        <!-- ğŸ”¥ active ì œê±°ë¨ -->
        <div class="menu-item" id="menuShare" onclick="location.href='share.html'">ì¥ì†Œ ê³µìœ </div>
      </nav>

      <button id="langToggle" class="lang-toggle">JP</button>
    </div>
  </header>

  <div class="wrap">
    <main class="main">

      <div class="post-form-container">
        <h2 id="formTitle">ê²Œì‹œê¸€ ì‘ì„±</h2>

        <div class="form-group">
          <label id="labelTitle">ì œëª©</label>
          <input type="text" id="postTitle" placeholder="ê²Œì‹œê¸€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" />
        </div>

        <div class="form-group">
          <label id="labelContent">ë³¸ë¬¸ ë‚´ìš©</label>
          <textarea id="postContent" placeholder="ë³¸ë¬¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
        </div>

        <div class="form-group">
          <label id="labelTags">íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
          <input type="text" id="postTags" placeholder="ì˜ˆ: ì‚°ì±…, ë¼ë©˜, êµë¥˜" />
        </div>

       <div class="form-group">
  <label id="labelImage" for="postImage">ì´ë¯¸ì§€ (ì„ íƒ)</label>
  <input
    type="file"
    id="postImage"
    accept="image/*"
  />
</div>

  <div class="form-group">
    <label id="labelLocation">ìœ„ì¹˜ URL (êµ¬ê¸€ ì§€ë„) *</label>
    <input type="text" id="postLocation" placeholder="https://maps.google.com/..." />
  </div>

  <!-- ë²„íŠ¼ì— id ì¶”ê°€ (I18Nì—ì„œ submit í…ìŠ¤íŠ¸ ë°”ê¿€ ë•Œ í•„ìš”) -->
  <button type="button" id="submitBtn" onclick="submitPost()">ì‘ì„± ì™„ë£Œ</button>

    </div>
  </main>
  <aside class="sidebar"></aside>
  </div>

  <script>
    const WRITE_LANG_KEY = "WRITE_PAGE_LANG";
    const API_BASE = "http://localhost:3000";

    const I18N = {
      KR: {
        formTitle: "ê²Œì‹œê¸€ ì‘ì„±",
        title: "ì œëª©",
        content: "ë³¸ë¬¸ ë‚´ìš©",
        tags: "íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„)",
        image: "ì´ë¯¸ì§€ (ì„ íƒ)",
        location: "ìœ„ì¹˜ URL (êµ¬ê¸€ ì§€ë„) *",
        placeholderTitle: "ê²Œì‹œê¸€ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”",
        placeholderContent: "ë³¸ë¬¸ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”",
        placeholderTags: "ì˜ˆ: ì‚°ì±…, ë¼ë©˜, êµë¥˜",
        placeholderLocation: "https://maps.google.com/...",
        submit: "ì‘ì„± ì™„ë£Œ",

        menuMain: "ë©”ì¸",
        menuVocab: "ë‹¨ì–´ì¥",
        menuShare: "ì¥ì†Œ ê³µìœ ",
      },

      JP: {
        formTitle: "æŠ•ç¨¿ä½œæˆ",
        title: "ã‚¿ã‚¤ãƒˆãƒ«",
        content: "æœ¬æ–‡",
        tags: "ã‚¿ã‚°ï¼ˆã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šï¼‰",
        image: "ç”»åƒï¼ˆä»»æ„ï¼‰",
        location: "å ´æ‰€URLï¼ˆGoogleãƒãƒƒãƒ—ï¼‰ *",
        placeholderTitle: "æŠ•ç¨¿ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
        placeholderContent: "æœ¬æ–‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„",
        placeholderTags: "ä¾‹ï¼šæ•£æ­©, ãƒ©ãƒ¼ãƒ¡ãƒ³, äº¤æµ",
        placeholderLocation: "https://maps.google.com/...",
        submit: "æŠ•ç¨¿å®Œäº†",

        menuMain: "ãƒ¡ã‚¤ãƒ³",
        menuVocab: "å˜èªå¸³",
        menuShare: "å ´æ‰€å…±æœ‰",
      }
    };

    function getLang() {
      return localStorage.getItem(WRITE_LANG_KEY) || "KR";
    }

    function applyLangUI() {
      const lang = getLang();
      const T = I18N[lang];

      document.getElementById("siteTitle").textContent = T.formTitle;
      document.getElementById("formTitle").textContent = T.formTitle;

      document.getElementById("labelTitle").textContent = T.title;
      document.getElementById("labelContent").textContent = T.content;
      document.getElementById("labelTags").textContent = T.tags;
      document.getElementById("labelImage").textContent = T.image;
      document.getElementById("labelLocation").textContent = T.location;

      document.getElementById("postTitle").placeholder = T.placeholderTitle;
      document.getElementById("postContent").placeholder = T.placeholderContent;
      document.getElementById("postTags").placeholder = T.placeholderTags;
      document.getElementById("postLocation").placeholder = T.placeholderLocation;

      document.getElementById("submitBtn").textContent = T.submit;
      document.getElementById("langToggle").textContent = lang === "KR" ? "JP" : "KR";

      document.getElementById("menuMain").textContent = T.menuMain;
      document.getElementById("menuVocab").textContent = T.menuVocab;
      document.getElementById("menuShare").textContent = T.menuShare;
    }

    document.getElementById("langToggle").addEventListener("click", () => {
      const cur = getLang();
      localStorage.setItem(WRITE_LANG_KEY, cur === "KR" ? "JP" : "KR");
      applyLangUI();
    });

    applyLangUI();

async function submitPost() {
  const title = document.getElementById("postTitle").value.trim();
  const content = document.getElementById("postContent").value.trim();
  const locationUrl = document.getElementById("postLocation").value.trim();

  const tagInput = document.getElementById("postTags");
  const tagsRaw = tagInput ? tagInput.value.trim() : "";

  const imageInput = document.getElementById("postImage");
  const imageFile = imageInput && imageInput.files ? imageInput.files[0] : null;

  if (!title || !content || !locationUrl) {
    alert("ì œëª©, ë³¸ë¬¸, ìœ„ì¹˜ URLì€ ë°˜ë“œì‹œ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");
    return;
  }

  const tags = tagsRaw
    ? tagsRaw.split(",").map(t => t.trim()).filter(Boolean)
    : [];

  const descriptionFull = content + "\n\n[ìœ„ì¹˜]\n" + locationUrl;

  let imageUrl = null;

  try {
    // 1) ì´ë¯¸ì§€ íŒŒì¼ì´ ìˆìœ¼ë©´ ë¨¼ì € ì—…ë¡œë“œí•´ì„œ URL ë°›ê¸°
    if (imageFile) {
      const formData = new FormData();
      formData.append("image", imageFile);

      const uploadRes = await fetch(API_BASE + "/api/upload-image", {
        method: "POST",
        body: formData
      });

      const uploadData = await uploadRes.json().catch(() => ({}));

      if (!uploadRes.ok) {
        alert(uploadData.error || "ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
        return;
      }

      // ì„œë²„ê°€ ëŒë ¤ì¤€ /uploads/~~~ ê²½ë¡œ
      imageUrl = uploadData.image_url;
    }

    // 2) ì¥ì†Œ ì •ë³´ + image_urlì„ DBì— ì €ì¥
    const res = await fetch(API_BASE + "/api/places", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        title,
        description: descriptionFull,
        tags,
        lat: null,
        lng: null,
        image_url: imageUrl
      })
    });

    const data = await res.json().catch(() => ({}));

    if (!res.ok) {
      alert(data.error || "ì¥ì†Œ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      return;
    }

    alert("ì¥ì†Œê°€ ì„±ê³µì ìœ¼ë¡œ ê³µìœ ë˜ì—ˆìŠµë‹ˆë‹¤!");
    location.href = "share.html";
  } catch (err) {
    console.error(err);
    alert("ì„œë²„ì™€ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
  }
}


</script>

</body>
</html>
